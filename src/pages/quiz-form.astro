---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Banner from "../assets/private-pilot-sits-in-multi-engine-plane.jpg";
import { MdOutlineQuiz } from "react-icons/md";
const QUIZ_FORM_WEBHOOK_URL = import.meta.env.QUIZ_FORM_WEBHOOK_URL;
const PORTAL_API_KEY = import.meta.env.PORTAL_API_KEY;
---

<BaseLayout
  siteTitle="Pilot Training Inquiry | High Tide Aviation"
  siteDescription="Fill out our revised pilot training inquiry form to assess your readiness and start your aviation journey with High Tide Aviation."
>
  <Header
    slot="header"
    image={Banner}
    title="Are You Ready to Become a Pilot?"
    alt="Private pilot sits in multi-engine plane"
  />

  <section class="py-16 px-5 max-w-5xl mx-auto">
    <div class="mx-auto flex flex-col justify-center items-center">
      <MdOutlineQuiz className="size-14 text-mustard-yellow mb-5" />
      <h2 class="uppercase text-medium-blue font-bold tracking-widest text-center">
        Pilot Training Inquiry Form
      </h2>
      <h3 class="text-5xl font-bold leading-tight text-dark-blue text-center max-w-3xl">
        High Tide Aviation Training Assessment
      </h3>
    </div>

    <form id="quiz-form" class="mt-10 space-y-12">
      <div class="space-y-8">
        <h2 class="text-2xl font-bold border-b-2 border-mustard-yellow pb-2 text-dark-blue">Personal Information</h2>
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
          <div>
            <label for="first-name" class="block font-medium text-dark-blue">First name</label>
            <input type="text" name="first-name" id="first-name" class="block w-full p-2 mt-1 rounded-md border-gray-300 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-medium-blue" required />
          </div>
          <div>
            <label for="last-name" class="block font-medium text-dark-blue">Last name</label>
            <input type="text" name="last-name" id="last-name" class="block w-full p-2 mt-1 rounded-md border-gray-300 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-medium-blue" required />
          </div>
          <div>
            <label for="email" class="block font-medium text-dark-blue">Email address</label>
            <input id="email" name="email" type="email" class="block w-full p-2 mt-1 rounded-md border-gray-300 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-medium-blue" required />
          </div>
          <div>
            <label for="phone" class="block font-medium text-dark-blue">Phone</label>
            <input id="phone" name="phone" type="tel" class="block w-full p-2 mt-1 rounded-md border-gray-300 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-medium-blue" required />
          </div>
          <div class="hidden">
            <input name="confirm-email" />
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
        <fieldset>
          <legend class="font-bold text-dark-blue mb-3">Aircraft of Interest</legend>
          <div class="space-y-2">
            <label class="flex items-center gap-3"><input type="checkbox" name="aircraft-interest" value="Airplane" /> Airplane</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="aircraft-interest" value="Helicopter" /> Helicopter</label>
          </div>
        </fieldset>

        <fieldset>
          <legend class="font-bold text-dark-blue mb-3">Preferred Method of Contact</legend>
          <div class="space-y-2">
            <label class="flex items-center gap-3"><input type="radio" name="contact-method" value="Text" required /> Text</label>
            <label class="flex items-center gap-3"><input type="radio" name="contact-method" value="Email" /> Email</label>
            <label class="flex items-center gap-3"><input type="radio" name="contact-method" value="Phone Call" /> Phone Call</label>
          </div>
          <div class="mt-4">
            <label class="text-sm text-gray-600 block">If Phone, best days/times to contact you:</label>
            <input type="text" name="best-contact-time" class="block w-full p-2 mt-1 rounded-md ring-1 ring-gray-300" />
          </div>
        </fieldset>
      </div>

      <div class="space-y-6">
        <h2 class="text-2xl font-bold border-b-2 border-mustard-yellow pb-2 text-dark-blue">Pilot Background</h2>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">Do you have any prior flight experience?</legend>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <label class="flex items-center gap-3"><input type="radio" name="prior-experience" value="None" required /> None</label>
            <label class="flex items-center gap-3"><input type="radio" name="prior-experience" value="Discovery flight" /> Discovery flight</label>
            <label class="flex items-center gap-3"><input type="radio" name="prior-experience" value="Some flight training" /> Some flight training (not licensed)</label>
            <label class="flex items-center gap-3"><input type="radio" name="prior-experience" value="Licensed pilot" /> Licensed pilot (specify rating below)</label>
          </div>
        </fieldset>
        <div>
          <label class="block font-medium text-dark-blue">If yes, approximately how many flight hours do you have?</label>
          <input type="text" name="flight-hours" class="block w-full p-2 mt-1 rounded-md ring-1 ring-gray-300" />
        </div>
      </div>

      <div class="space-y-6">
        <h2 class="text-2xl font-bold border-b-2 border-mustard-yellow pb-2 text-dark-blue">Training Goals</h2>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">What certificate are you most interested in pursuing?</legend>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <label class="flex items-center gap-3"><input type="checkbox" name="pursuing-certificate" value="Private Pilot" /> Private Pilot</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="pursuing-certificate" value="Instrument" /> Instrument</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="pursuing-certificate" value="Commercial" /> Commercial</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="pursuing-certificate" value="CFI/CFII" /> CFI/CFII</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="pursuing-certificate" value="Multi Engine" /> Multi Engine</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="pursuing-certificate" value="Recreational only" /> Recreational flying only</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="pursuing-certificate" value="Not sure" /> Not sure yet — need guidance</label>
          </div>
        </fieldset>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">What is your long-term aviation goal?</legend>
          <div class="space-y-2">
            <label class="flex items-center gap-3"><input type="radio" name="long-term-goal" value="Recreational" required /> Recreational flying</label>
            <label class="flex items-center gap-3"><input type="radio" name="long-term-goal" value="Career pilot" /> Career pilot (airlines, charter, etc.)</label>
            <label class="flex items-center gap-3"><input type="radio" name="long-term-goal" value="Unsure" /> Unsure — exploring aviation</label>
          </div>
        </fieldset>
      </div>

      <div class="space-y-6">
        <h2 class="text-2xl font-bold border-b-2 border-mustard-yellow pb-2 text-dark-blue">Readiness & Commitment</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <fieldset>
            <legend class="font-medium text-dark-blue mb-3">How soon would you like to begin training?</legend>
            <select name="start-readiness" class="block w-full p-2 rounded-md ring-1 ring-gray-300">
              <option value="Immediately">Immediately</option>
              <option value="Within 30 days">Within 30 days</option>
              <option value="1–3 months">1–3 months</option>
              <option value="3+ months">3+ months</option>
            </select>
          </fieldset>
          <fieldset>
            <legend class="font-medium text-dark-blue mb-3">How often do you plan to fly?</legend>
            <select name="fly-frequency" class="block w-full p-2 rounded-md ring-1 ring-gray-300">
              <option value="1 lesson per week">1 lesson per week</option>
              <option value="2 lessons per week">2 lessons per week</option>
              <option value="3+ lessons per week">3+ lessons per week</option>
            </select>
          </fieldset>
        </div>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">Flexibility for additional study time?</legend>
          <div class="flex gap-10">
            <label class="flex items-center gap-3"><input type="radio" name="study-flexibility" value="Yes" required /> Yes</label>
            <label class="flex items-center gap-3"><input type="radio" name="study-flexibility" value="No" /> No</label>
          </div>
        </fieldset>
      </div>

      <div class="space-y-6">
        <h2 class="text-2xl font-bold border-b-2 border-mustard-yellow pb-2 text-dark-blue">Financial Planning</h2>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">How do you plan to pay for training?</legend>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <label class="flex items-center gap-3"><input type="checkbox" name="payment-plan" value="Pay-as-you-go" /> Pay-as-you-go</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="payment-plan" value="Financing" /> Financing</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="payment-plan" value="Scholarships" /> Scholarships / grants</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="payment-plan" value="Employer benefits" /> Employer benefits</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="payment-plan" value="GI Bill" /> GI Bill</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="payment-plan" value="NC TAP" /> NC TAP</label>
            <label class="flex items-center gap-3"><input type="checkbox" name="payment-plan" value="Not sure yet" /> Not sure yet</label>
          </div>
        </fieldset>
        <div>
          <label class="block font-medium text-dark-blue">Estimated monthly training budget?</label>
          <input type="text" name="monthly-budget" class="block w-full p-2 mt-1 rounded-md ring-1 ring-gray-300" />
        </div>
      </div>

      <div class="space-y-6">
        <h2 class="text-2xl font-bold border-b-2 border-mustard-yellow pb-2 text-dark-blue">Medical Eligibility</h2>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">Held an FAA Medical Certificate?</legend>
          <div class="flex gap-10">
            <label class="flex items-center gap-3"><input type="radio" name="held-medical" value="Yes" required /> Yes</label>
            <label class="flex items-center gap-3"><input type="radio" name="held-medical" value="No" /> No</label>
          </div>
        </fieldset>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">Known medical conditions that may affect eligibility?</legend>
          <div class="flex flex-wrap gap-10">
            <label class="flex items-center gap-3"><input type="radio" name="medical-conditions" value="No" required /> No</label>
            <label class="flex items-center gap-3"><input type="radio" name="medical-conditions" value="Yes" /> Yes</label>
          </div>
          <input type="text" name="medical-details" placeholder="Optional details" class="block w-full p-2 mt-2 rounded-md ring-1 ring-gray-300" />
        </fieldset>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">Currently taking any medications?</legend>
          <div class="flex flex-wrap gap-10">
            <label class="flex items-center gap-3"><input type="radio" name="taking-meds" value="No" required /> No</label>
            <label class="flex items-center gap-3"><input type="radio" name="taking-meds" value="Yes" /> Yes</label>
          </div>
          <input type="text" name="medication-details" placeholder="Optional details" class="block w-full p-2 mt-2 rounded-md ring-1 ring-gray-300" />
        </fieldset>
      </div>

      <div class="space-y-6">
        <h2 class="text-2xl font-bold border-b-2 border-mustard-yellow pb-2 text-dark-blue">Final Notes</h2>
        <fieldset>
          <legend class="font-medium text-dark-blue mb-3">How did you hear about us?</legend>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <label class="flex items-center gap-3"><input type="radio" name="marketing-source" value="Google" required /> Google / Online search</label>
            <label class="flex items-center gap-3"><input type="radio" name="marketing-source" value="Social media" /> Social media</label>
            <label class="flex items-center gap-3"><input type="radio" name="marketing-source" value="Referral" /> Referral</label>
            <label class="flex items-center gap-3"><input type="radio" name="marketing-source" value="Airport visit" /> Airport visit</label>
            <label class="flex items-center gap-3"><input type="radio" name="marketing-source" value="Other" /> Other</label>
          </div>
        </fieldset>
        <div>
          <label class="block font-medium text-dark-blue">Any questions for your consultation?</label>
          <textarea name="questions" rows="4" class="block w-full p-2 mt-1 rounded-md ring-1 ring-gray-300"></textarea>
        </div>
      </div>

      <div class="bg-gray-100 p-6 rounded-lg">
        <div class="flex gap-3 items-start">
          <input type="checkbox" id="agree-data-collection" class="h-5 w-5 mt-1" />
          <label for="agree-data-collection" class="text-gray-600 text-sm">
            I agree to receive messages from High Tide Aviation.
          </label>
        </div>
        <button type="submit" id="submit-button" class="btn-blue w-full mt-6 opacity-50 cursor-not-allowed" disabled>Submit Assessment</button>
      </div>
    </form>
  </section>

  <script define:vars={{ QUIZ_FORM_WEBHOOK_URL, PORTAL_API_KEY }}>
    const checkbox = document.getElementById("agree-data-collection");
    const submitButton = document.getElementById("submit-button");

    checkbox.addEventListener("change", () => {
      submitButton.disabled = !checkbox.checked;
      submitButton.classList.toggle("opacity-50", !checkbox.checked);
      submitButton.classList.toggle("cursor-not-allowed", !checkbox.checked);
    });

    document.getElementById("quiz-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      if (formData.get("confirm-email")) return;

      const metadata = {};
      const excluded = ["first-name", "last-name", "email", "phone", "confirm-email", "agree-data-collection"];
      
      formData.forEach((value, key) => {
        if (!excluded.includes(key)) {
          if (metadata[key]) {
            metadata[key] = Array.isArray(metadata[key]) ? [...metadata[key], value] : [metadata[key], value];
          } else {
            metadata[key] = value;
          }
        }
      });

      const jsonBody = {
        first_name: formData.get("first-name"),
        last_name: formData.get("last-name"),
        email: formData.get("email"),
        phone: formData.get("phone"),
        campaign: "revised_quiz_2026",
        account_random_id: "ac_yec3jxiy",
        metadata: metadata
      };

      try {
        const [ghl, portal] = await Promise.all([
          fetch(QUIZ_FORM_WEBHOOK_URL, { method: "POST", body: new URLSearchParams(formData) }),
          fetch("https://portal.rightruddermarketing.com/api/leads", {
            method: "POST",
            headers: { "Content-Type": "application/json", "x-api-key": PORTAL_API_KEY },
            body: JSON.stringify(jsonBody)
          })
        ]);

        if (ghl.ok && portal.ok) window.location.href = "/quiz-confirmation";
      } catch (err) { console.error(err); }
    });
  </script>
</BaseLayout>